---
import { actions } from 'astro:actions';
---

<div class="bg-white p-8 border-2 border-black shadow-[8px_8px_0px_0px_rgba(0,0,0,1)] transform rotate-1 hover:rotate-0 transition-transform duration-300">
  <div class="border-b-2 border-black pb-4 mb-6">
    <h2 class="text-3xl font-black uppercase tracking-tight">Contact Us</h2>
    <p class="font-mono text-sm text-gray-500 mt-1">Ready to start? Let's talk.</p>
  </div>
  <form method="POST" action={actions.leads.create} class="space-y-6" id="contact-form">
    <div>
      <label for="email" class="block text-sm font-bold uppercase tracking-wider text-black mb-2">Email</label>
      <input 
        type="email" 
        name="email" 
        id="email" 
        required 
        class="block w-full border-2 border-black rounded-none shadow-[4px_4px_0px_0px_rgba(0,0,0,0.1)] p-3 focus:outline-none focus:ring-0 focus:shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] focus:translate-x-[-2px] focus:translate-y-[-2px] transition-all bg-gray-50"
        placeholder="you@example.com"
      />
    </div>
    <div>
      <label for="message" class="block text-sm font-bold uppercase tracking-wider text-black mb-2">Message</label>
      <textarea 
        name="message" 
        id="message" 
        rows="4" 
        required 
        class="block w-full border-2 border-black rounded-none shadow-[4px_4px_0px_0px_rgba(0,0,0,0.1)] p-3 focus:outline-none focus:ring-0 focus:shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] focus:translate-x-[-2px] focus:translate-y-[-2px] transition-all bg-gray-50"
        placeholder="Tell us about your project..."
      ></textarea>
    </div>
    <button 
      type="submit" 
      class="w-full flex justify-center py-3 px-6 border-2 border-black shadow-[4px_4px_0px_0px_rgba(0,0,0,1)] text-sm font-bold uppercase tracking-widest text-white bg-black hover:bg-white hover:text-black hover:shadow-none hover:translate-x-[4px] hover:translate-y-[4px] transition-all"
    >
      Send Message
    </button>
    <p id="form-status" class="text-sm mt-4 hidden text-center font-mono font-bold"></p>
  </form>
</div>

<script>
  import { actions } from 'astro:actions';

  const form = document.querySelector('#contact-form') as HTMLFormElement;
  const status = document.querySelector('#form-status') as HTMLParagraphElement;

  if (form) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      status.classList.remove('hidden');
      status.textContent = 'Sending...';
      status.className = 'text-sm mt-2 text-center text-gray-500';

      const formData = new FormData(form);
      const { error } = await actions.leads.create(formData);

      if (error) {
        status.textContent = 'Error: ' + error.message;
        status.className = 'text-sm mt-2 text-center text-red-600';
      } else {
        status.textContent = 'Thank you! We received your message.';
        status.className = 'text-sm mt-2 text-center text-green-600';
        form.reset();
      }
    });
  }
</script>
